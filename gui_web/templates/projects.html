<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Projects</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
</head>
<body>
    <div class="container mt-5">
        <h1>Projects</h1>
        <a href="/" class="btn btn-secondary mt-3">&larr; Back to Home</a>
        <p class="mt-4">This is a placeholder for the Projects page.</p>
        <button class="btn btn-primary mt-4" data-bs-toggle="modal" data-bs-target="#searchModal">Search Projects</button>
    </div>

    <!-- Search Modal with fields -->
    <div class="modal fade" id="searchModal" tabindex="-1" aria-labelledby="searchModalLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="searchModalLabel">Search Projects</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <form id="search-projects-form">
              <div class="mb-3">
                <label for="search-project-id" class="form-label">Project Id</label>
                <input type="text" class="form-control" id="search-project-id" name="project_id" placeholder="Enter Project Id">
              </div>
              <div class="mb-3">
                <label for="search-branch" class="form-label">Branch</label>
                <input type="text" class="form-control" id="search-branch" name="branch" placeholder="Enter Branch">
              </div>
              <div class="mb-3">
                <label for="search-operations" class="form-label">Operations</label>
                <input type="text" class="form-control" id="search-operations" name="operations" placeholder="Enter Operations">
              </div>
              <div class="mb-3">
                <label for="search-description" class="form-label">Description</label>
                <input type="text" class="form-control" id="search-description" name="description" placeholder="Enter Description">
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            <button type="button" class="btn btn-primary" id="search-projects-btn">Search</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Results Modal -->
    <div class="modal fade" id="resultsModal" tabindex="-1" aria-labelledby="resultsModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="resultsModalLabel">Search Results</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <div id="search-results-container">
              <!-- Results will be injected here -->
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
          </div>
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
    document.getElementById('search-projects-btn').addEventListener('click', function() {
      const form = document.getElementById('search-projects-form');
      const formData = new FormData(form);
      const params = new URLSearchParams();
      for (const [key, value] of formData.entries()) {
        params.append(key, value);
      }
      // Fetch search results
      fetch(`/search-projects?${params.toString()}`)
        .then(response => response.json())
        .then(data => {
          let html = '';
          if (!Array.isArray(data) || data.length === 0) {
            html = '<div class="alert alert-warning">No projects found.</div>';
          } else {
            html += '<table class="table table-bordered"><thead><tr><th>Project Id</th><th>Branch</th><th>Operations</th><th>Description</th><th>Depreciation Method</th></tr></thead><tbody>';
            data.forEach(function(proj) {
              if (typeof proj !== 'object' || proj === null) return;
              html += '<tr>';
              html += `<td>${proj.project_id ?? proj['project_id'] ?? ''}</td>`;
              html += `<td>${proj.branch ?? proj['branch'] ?? ''}</td>`;
              html += `<td>${proj.operations ?? proj['operations'] ?? ''}</td>`;
              html += `<td>${proj.description ?? proj['description'] ?? ''}</td>`;
              html += `<td>${proj.depreciation_method ?? proj['depreciation_method'] ?? ''}</td>`;
              html += '</tr>';
            });
            html += '</tbody></table>';
          }
          document.getElementById('search-results-container').innerHTML = html;
          // Hide the search modal only after results are ready
          const searchModal = bootstrap.Modal.getInstance(document.getElementById('searchModal'));
          if (searchModal) searchModal.hide();
          const resultsModal = new bootstrap.Modal(document.getElementById('resultsModal'));
          resultsModal.show();
        })
        .catch(err => {
          document.getElementById('search-results-container').innerHTML = '<div class="alert alert-danger">Error fetching results: ' + err + '</div>';
          const resultsModal = new bootstrap.Modal(document.getElementById('resultsModal'));
          resultsModal.show();
        });
    });
    </script>
</body>
</html>
